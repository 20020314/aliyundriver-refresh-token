kind: pipeline
type: docker
name: Build
clone:
  disable: true
steps:
- name: 拉取项目
  image: alpine
  volumes:
  - name: cache
    path: /vue
  commands:
  - apk update
  - apk add git bash
  - cd /vue
  - git clone https://github.com/20020314/aliyundriver-refresh-token.git
- name: 安装依赖
  image: node:16.15.0
  volumes:
  - name: cache
    path: /vue
  commands:
  - cd /vue/aliyundriver-refresh-token
  - npm install vite
  - npx vite build
- name: 上传项目文件
  image: plugins/s3
  volumes:
  - name: cache
    path: /vue/aliyundriver-refresh-token
  settings:
    source: /vue/**/*
    target: /
    bucket: pe5i8m-html
    environment:
    endpoint:
      from_secret: MINIO_HOST
    access_key:
      from_secret: MINIO_ID
    secret_key:
      from_secret: MINIO_KEY

volumes:
- name: cache
  temp: {}
